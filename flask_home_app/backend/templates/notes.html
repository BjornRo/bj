{% extends "base.html" %}
{% block header %}
{% if local %}
<style>
</style>
{% endif %}
{% endblock %}
{% block title %}{{title}}{% endblock %}
{% block content %}
{% if local %}

<div class="row" style="max-width: fit-content;">
    <div id="col1" class="ml-4 mt-3" style="width: 32rem;">

        <div id="scroller">
            <template id="post_template">
                <div class="card ml-2 mt-2 shadow">
                    <div id="title" class="card-header">
                        Header
                    </div>
                    <div id="content" class="card-body">
                        Hello
                    </div>
                    <div class="card-footer text-muted">
                        <div class="btn-group" role="group" aria-label="Basic example">
                            <button id="delpost" type="button" class="btn btn-danger">Delete</button>
                            <button id="editpost" type="button" class="btn btn-info">Edit Post</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>


        <div class="d-flex justify-content-center mb-3" id="sentinel">
            <div class="spinner-border" role="status"></div>
        </div>


    </div>







    <!-- col 2 -->
    <div id="col2" class="ml-3 mt-3" style="width: 32rem;">
        <div class="card position-sticky mt-2 shadow">
            <h5 class="card-header">Add post</h5>
            <div class="card-body" style="float:right;">
                <textarea id="posttext" rows="10" cols="50"
                    style="resize: none; font-family: monospace; font-size: 16px;" placeholder="Text here"></textarea>
            </div>
            <div class="card-footer text-muted">
                <button id="postbtn" class="btn btn-primary" style="float: right;">Post</a>
            </div>
        </div>
    </div>
</div>


<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
    Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

{% else %}
<div class="card text-white bg-danger mb-3" style="max-width: 18rem;">
    <div class="card-header m-3">
        <h5 class="card-title">Only accessible from local network!</h5>
    </div>
</div>
{%endif%}
{% endblock %}

{% block script %}
{% if local %}
<script type="text/javascript">
    var scroller = document.querySelector("#scroller");
    var template = document.querySelector("#post_template");
    var sentinel = document.querySelector("#sentinel");
    var counter = 0;

    function loadItems() {
        fetch(`/api?c=${counter}`).then((response) => {
            response.json().then((data) => {

                if (!data.length) {
                    sentinel.innerHTML = "No more posts";
                }
                for (var i = 0; i < data.length; i++) {
                    let template_clone = template.content.cloneNode(true);
                    template_clone.querySelector("#title").innerHTML = `${data[i][0]}`;
                    template_clone.querySelector("#content").innerHTML = `${data[i][1]}`;
                    template_clone.querySelector("#delpost").id = `${data[i][0]}`;
                    template_clone.querySelector("#editpost").id = `${data[i][0]}`;
                    scroller.appendChild(template_clone);
                    counter++;
                }
            })
        })
    };
    var intersectionObserver = new IntersectionObserver(entries => {
        if (entries[0].intersectionRatio <= 0) return;
        loadItems();
    });
    intersectionObserver.observe(sentinel);


    // $("#postbtn").click(function (e) {
    //     e.preventDefault();
    //     var formdata = document.getElementById("posttext").value;
    //     if (formdata.length == 0) {
    //         alert("Please enter text!")
    //     }
    //     $.ajax({
    //         url: "{{url_for('views.api')}}",
    //         method: "POST",
    //         data: { "text": formdata },
    //         success: function (data) {
    //         }
    //     });
    // });

</script>
{%endif%}
{% endblock %}